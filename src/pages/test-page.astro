---
import Layout from '../layouts/Layout.astro';
import TestIsland from '../components/svelte/TestIsland.svelte';
import DirectusService from '../services/directus';

const directus = new DirectusService();
let recipes = [];
try {
  recipes = await directus.getRecipes();
  console.log('Recipes fetched on test-page:', recipes);
} catch (error) {
  console.error('Failed to fetch recipes on test-page:', error);
}
---

<Layout title="Test Page - Directus & Svelte" isHomePage={false}>
  <h1>Directus Data Fetching Test</h1>
  <p>Attempting to fetch recipes from Directus and display them.</p>
  
  {recipes.length > 0 ? (
    <ul>
      {recipes.map(recipe => (
        <li>
          <h2>{recipe.title}</h2>
          <p><strong>Cuisine:</strong> {recipe.cuisine || 'N/A'}</p>
          <p><strong>Prep Time:</strong> {recipe.prep_time || 'N/A'} minutes</p>
          <p><strong>Cook Time:</strong> {recipe.cook_time || 'N/A'} minutes</p>
          {recipe.image && <img src={directus.getAssetUrl(recipe.image)} alt={recipe.title} width="200" />}
        </li>
      ))}
    </ul>
  ) : (
    <p>No recipes found or failed to load.</p>
  )}

  <hr />
  <h2>Svelte Island Test</h2>
  <TestIsland client:load />
</Layout> 